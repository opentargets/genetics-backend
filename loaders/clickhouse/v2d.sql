create database if not exists ot;
create table if not exists ot.v2d_by_chrpos(
  study_id String,
  pmid Nullable(String),
  pub_date Nullable(String),
  pub_journal Nullable(String),
  pub_title Nullable(String),
  pub_author Nullable(String),
  has_sumstats UInt8,
  trait_reported String,
  trait_efos Array(String) default [],
  ancestry_initial Array(String) default [],
  ancestry_replication Array(String) default [],
  n_initial Nullable(UInt32),
  n_replication Nullable(UInt32),
  n_cases Nullable(UInt32),
  trait_category Nullable(String),
  num_assoc_loci Nullable(UInt32),
  lead_chrom Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, '5' = 5, '6' = 6, '7' = 7, '8' = 8, '9' = 9, '10' = 10, '11' = 11, '12' = 12, '13' = 13, '14' = 14, '15' = 15, '16' = 16, '17' = 17, '18' = 18, '19' = 19, '20' = 20, '21' = 21, '22' = 22, 'X'= 23, 'Y' = 24, 'MT'=25 ),
  lead_pos UInt32,
  lead_ref String,
  lead_alt String,
  tag_chrom Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, '5' = 5, '6' = 6, '7' = 7, '8' = 8, '9' = 9, '10' = 10, '11' = 11, '12' = 12, '13' = 13, '14' = 14, '15' = 15, '16' = 16, '17' = 17, '18' = 18, '19' = 19, '20' = 20, '21' = 21, '22' = 22, 'X'= 23, 'Y' = 24, 'MT'=25 ),
  tag_pos UInt32,
  tag_ref String,
  tag_alt String,
  overall_r2 Nullable(Float64),
  AFR_1000G_prop Nullable(Float64),
  AMR_1000G_prop Nullable(Float64),
  EAS_1000G_prop Nullable(Float64),
  EUR_1000G_prop Nullable(Float64),
  SAS_1000G_prop Nullable(Float64),
  log10_ABF Nullable(Float64),
  posterior_prob Nullable(Float64),
  odds_ratio Nullable(Float64),
  oddsr_ci_lower Nullable(Float64),
  oddsr_ci_upper Nullable(Float64),
  direction Nullable(String),
  beta Nullable(Float64),
  beta_ci_lower Nullable(Float64),
  beta_ci_upper Nullable(Float64),
  pval_mantissa Float64,
  pval_exponent Int32,
  pval Float64)
engine MergeTree partition by (lead_chrom) order by (lead_pos, lead_ref, lead_alt);

create table if not exists ot.v2d_by_stchr(
  study_id String,
  pmid Nullable(String),
  pub_date Nullable(String),
  pub_journal Nullable(String),
  pub_title Nullable(String),
  pub_author Nullable(String),
  has_sumstats UInt8,
  trait_reported String,
  trait_efos Array(String) default [],
  ancestry_initial Array(String) default [],
  ancestry_replication Array(String) default [],
  n_initial Nullable(UInt32),
  n_replication Nullable(UInt32),
  n_cases Nullable(UInt32),
  trait_category Nullable(String),
  num_assoc_loci Nullable(UInt32),
  lead_chrom Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, '5' = 5, '6' = 6, '7' = 7, '8' = 8, '9' = 9, '10' = 10, '11' = 11, '12' = 12, '13' = 13, '14' = 14, '15' = 15, '16' = 16, '17' = 17, '18' = 18, '19' = 19, '20' = 20, '21' = 21, '22' = 22, 'X'= 23, 'Y' = 24, 'MT'=25 ),
  lead_pos UInt32,
  lead_ref String,
  lead_alt String,
  tag_chrom Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, '5' = 5, '6' = 6, '7' = 7, '8' = 8, '9' = 9, '10' = 10, '11' = 11, '12' = 12, '13' = 13, '14' = 14, '15' = 15, '16' = 16, '17' = 17, '18' = 18, '19' = 19, '20' = 20, '21' = 21, '22' = 22, 'X'= 23, 'Y' = 24, 'MT'=25 ),
  tag_pos UInt32,
  tag_ref String,
  tag_alt String,
  overall_r2 Nullable(Float64),
  AFR_1000G_prop Nullable(Float64),
  AMR_1000G_prop Nullable(Float64),
  EAS_1000G_prop Nullable(Float64),
  EUR_1000G_prop Nullable(Float64),
  SAS_1000G_prop Nullable(Float64),
  log10_ABF Nullable(Float64),
  posterior_prob Nullable(Float64),
  odds_ratio Nullable(Float64),
  oddsr_ci_lower Nullable(Float64),
  oddsr_ci_upper Nullable(Float64),
  direction Nullable(String),
  beta Nullable(Float64),
  beta_ci_lower Nullable(Float64),
  beta_ci_upper Nullable(Float64),
  pval_mantissa Float64,
  pval_exponent Int32,
  pval Float64)
engine MergeTree partition by (lead_chrom) order by (study_id, lead_pos, lead_ref, lead_alt);

insert into ot.v2d_by_chrpos
select
  study_id ,
  pmid ,
  pub_date ,
  pub_journal ,
  pub_title ,
  pub_author ,
  has_sumstats,
  trait_reported ,
  trait_efos ,
  ancestry_initial ,
  ancestry_replication ,
  n_initial ,
  n_replication ,
  n_cases ,
  trait_category ,
  num_assoc_loci ,
  cast(assumeNotNull(lead_chrom) as Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, '5' = 5, '6' = 6, '7' = 7, '8' = 8, '9' = 9, '10' = 10, '11' = 11, '12' = 12, '13' = 13, '14' = 14, '15' = 15, '16' = 16, '17' = 17, '18' = 18, '19' = 19, '20' = 20, '21' = 21, '22' = 22, 'X'= 23, 'Y' = 24, 'MT'=25 )) as lead_chrom,
  lead_pos ,
  lead_ref ,
  lead_alt ,
  cast(assumeNotNull(tag_chrom) as Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, '5' = 5, '6' = 6, '7' = 7, '8' = 8, '9' = 9, '10' = 10, '11' = 11, '12' = 12, '13' = 13, '14' = 14, '15' = 15, '16' = 16, '17' = 17, '18' = 18, '19' = 19, '20' = 20, '21' = 21, '22' = 22, 'X'= 23, 'Y' = 24, 'MT'=25 )) as tag_chrom,
  tag_pos ,
  tag_ref ,
  tag_alt ,
  overall_r2 ,
  AFR_1000G_prop ,
  AMR_1000G_prop ,
  EAS_1000G_prop ,
  EUR_1000G_prop ,
  SAS_1000G_prop ,
  log10_ABF ,
  posterior_prob ,
  odds_ratio ,
  oddsr_ci_lower ,
  oddsr_ci_upper ,
  direction ,
  beta ,
  beta_ci_lower ,
  beta_ci_upper ,
  pval_mantissa ,
  pval_exponent ,
  pval
from ot.v2d_log;
insert into ot.v2d_by_stchr
select
       study_id ,
  pmid ,
  pub_date ,
  pub_journal ,
  pub_title ,
  pub_author ,
  has_sumstats,
  trait_reported ,
  trait_efos ,
  ancestry_initial ,
  ancestry_replication ,
  n_initial ,
  n_replication ,
  n_cases ,
  trait_category ,
  num_assoc_loci ,
  cast(assumeNotNull(lead_chrom) as Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, '5' = 5, '6' = 6, '7' = 7, '8' = 8, '9' = 9, '10' = 10, '11' = 11, '12' = 12, '13' = 13, '14' = 14, '15' = 15, '16' = 16, '17' = 17, '18' = 18, '19' = 19, '20' = 20, '21' = 21, '22' = 22, 'X'= 23, 'Y' = 24, 'MT'=25 )) as lead_chrom,
  lead_pos ,
  lead_ref ,
  lead_alt ,
  cast(assumeNotNull(tag_chrom) as Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, '5' = 5, '6' = 6, '7' = 7, '8' = 8, '9' = 9, '10' = 10, '11' = 11, '12' = 12, '13' = 13, '14' = 14, '15' = 15, '16' = 16, '17' = 17, '18' = 18, '19' = 19, '20' = 20, '21' = 21, '22' = 22, 'X'= 23, 'Y' = 24, 'MT'=25 )) as tag_chrom,
  tag_pos ,
  tag_ref ,
  tag_alt ,
  overall_r2 ,
  AFR_1000G_prop ,
  AMR_1000G_prop ,
  EAS_1000G_prop ,
  EUR_1000G_prop ,
  SAS_1000G_prop ,
  log10_ABF ,
  posterior_prob ,
  odds_ratio ,
  oddsr_ci_lower ,
  oddsr_ci_upper ,
  direction ,
  beta ,
  beta_ci_lower ,
  beta_ci_upper ,
  pval_mantissa ,
  pval_exponent ,
  pval
from ot.v2d_log;
